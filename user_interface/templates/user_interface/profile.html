{% extends "user_interface/header.html"%}

{% block content %}
	<div class="container">
	    <h1>Jane Doe</h1>
	  	<hr>
		<div class="row">
	      <!-- left column -->
	      <div class="col-md-3">
	        <div class="text-center">
	          <img src="//placehold.it/100" class="avatar img-circle" alt="avatar">
	          <h6>@jane_doe1</h6>
	        </div>
	      </div>

	      <!-- edit form column -->
	      <div class="col-md-9 personal-info">
	        <h3>Personal info</h3>
		    <div class="col-lg-8">
		    	Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
		    </div>
		  </div>
	  	</div>
	<hr>
	</div>
	<div class="container calCont" style="">
		  	<div class="row calHeader text-xs-center" id="cal_head">
		  		<div class="col left-block text-left">
					<div>
						<button type="button"> < </button>
						<button type="button"> Today </button>
						<button type="button"> > </button>
		  			</div>
		  		</div>
			  	<div class="col center-block text-center" id="cal_head_text">
			  		January 1970
			  	</div>
		  		<div class="col right-block text-right">
		  			<div class="form-check-inline">
			  		<label class="form-check-label">
			    		<input type="radio" class="form-check-input" id="monthRadio" name="optradio" onclick="switchCalendarView('cal_grid_cont', 'month');" checked>Month
			  		</label>
					</div>
					<div class="form-check-inline">
			  		<label class="form-check-label">
			    		<input type="radio" class="form-check-input" id="weekRadio" name="optradio" onclick="switchCalendarView('cal_grid_cont', 'week');">Week
			 		 </label>
					</div>
					<div class="form-check-inline disabled">
			  		<label class="form-check-label">
			   		 <input type="radio" class="form-check-input" id="dayRadio" name="optradio" onclick="switchCalendarView('cal_grid_cont', 'day');">Day
			  		</label>
					</div>
		  		</div>
		  	</div>
		  	<div class="row calHeader text-xs-center" id="cal_head">
		  		<div class="col right-block text-right">
					<div>
						<button type="button" data-toggle="modal" data-target="#createEventModal">Create Event</button>
						<button type="button"  data-toggle="modal" data-target="#editEventModal">Edit Event</button>
		  			</div>
		  		</div>
		  	</div>
		  	<div id="cal_grid_cont" style="padding-top: 20px;">

		  	</div>
	</div>
	<div class="modal fade" id="createEventModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="createEventModalLongTitle">Create a New Event</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <form>
			  	<div class="form-group">
				    <label class="reqField" for="inputEventName">Event Name</label>
				    <input type="text" class="form-control" id="inputEventName" pattern="^[a-zA-Z0-9 ]*$" required>
				</div>
				<div class="form-row">
				  <div class="form-group col-md-6">
				    <label class="reqField" for="inputStartDate">Start Date</label>
				    <input class="form-control" type="date" id="inputStartDate" pattern="(?n:^(?=\d)((?<month>(0?[13578])|1[02]|(0?[469]|11)(?!.31)|0?2(?(.29)(?=.29.((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|(16|[2468][048]|[3579][26])00))|(?!.3[01])))(?<sep>[-./])(?<day>0?[1-9]|[12]\d|3[01])\k<sep>(?<year>(1[6-9]|[2-9]\d)\d{2})(?(?=\x20\d)\x20|$))?(?<time>((0?[1-9]|1[012])(:[0-5]\d){0,2}(?i:\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$)$" required>
				  </div>
				  <div class="form-group col-md-6">
				    <label class="reqField" for="inputEndDate">End Date</label>
				    <input class="form-control" type="date" id="inputEndDate" pattern="(?n:^(?=\d)((?<month>(0?[13578])|1[02]|(0?[469]|11)(?!.31)|0?2(?(.29)(?=.29.((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|(16|[2468][048]|[3579][26])00))|(?!.3[01])))(?<sep>[-./])(?<day>0?[1-9]|[12]\d|3[01])\k<sep>(?<year>(1[6-9]|[2-9]\d)\d{2})(?(?=\x20\d)\x20|$))?(?<time>((0?[1-9]|1[012])(:[0-5]\d){0,2}(?i:\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$)$" required>
				  </div>
				</div>
				<div class="form-row">
				  <div class="form-group col-md-6">
				    <label class="reqField" for="inputRepeatType">Repeat</label>
				    <select class="form-control" id="inputRepeatType">
					  <option value="day"  selected="selected">Daily</option>
					  <option value="week">Weekly</option>
					  <option value="month">Monthly</option>
					  <option value="year">Yearly</option>
					</select>
				  </div>
				  <div class="form-group col-md-6">
				    <label class="reqField" for="inputUntilDate">Until</label>
				    <input class="form-control" type="date" id="inputUntilDate" pattern="(?n:^(?=\d)((?<month>(0?[13578])|1[02]|(0?[469]|11)(?!.31)|0?2(?(.29)(?=.29.((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|(16|[2468][048]|[3579][26])00))|(?!.3[01])))(?<sep>[-./])(?<day>0?[1-9]|[12]\d|3[01])\k<sep>(?<year>(1[6-9]|[2-9]\d)\d{2})(?(?=\x20\d)\x20|$))?(?<time>((0?[1-9]|1[012])(:[0-5]\d){0,2}(?i:\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$)$" required>
				  </div>
				</div>
				<div id="inputRepeatPattern">

				</div>
				<div class="form-group">
				    <label for="inputInviteList">Invite</label>
				    <input type="text" class="form-control" id="inputInviteList" pattern="^[a-zA-Z0-9 ]*$">
				</div>
				<div class="form-row">
				  <div class="form-group col-md-6">
				    <label for="inputWhitelist">Whitelist</label>
				    <input type="text" class="form-control" id="inputWhitelist" pattern="^[a-zA-Z0-9 ]*$">
				  </div>
				  <div class="form-group col-md-6">
				    <label for="inputBlacklist">Blacklist</label>
				    <input type="text" class="form-control" id="inputBlacklist" pattern="^[a-zA-Z0-9 ]*$">
				  </div>
				</div>
			  <button type="submit" class="btn btn-primary">Create Event</button>
			</form>
	      </div>
	    </div>
	  </div>
	</div>
	<div class="modal fade" id="editEventModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="editEventModalLongTitle">Edit</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <form>
					  <div class="form-group">
						      <label class="reqField" for="inputEmailLogin">Email Address</label>
						    <input type="text" class="form-control" id="inputEmailLogin" pattern="^([\w\-\.]+)@((\[([0-9]{1,3}\.){3}[0-9]{1,3}\])|(([\w\-]+\.)+)([a-zA-Z]{2,4}))$" required>
						  </div>
					  <button type="submit" class="btn btn-primary">Login Button Here</button>
					</form>
	      </div>
	    </div>
	  </div>
	</div>
	<hr>
	<style type="text/css">
		.reqField:before{
			content:"*" ;
     		color:red;
		}
		.calHeader{
		}
		.defStyle{
			background-color: white;
			border-style: solid;
			border-width: 0.5px;
			border-color: lightgrey;
		}
		.defStyle:hover{
			background-color: #f2f2f2;
			border-width: 0.7px;
		}
		.calSelect{
			background-color: #bcd6ff;
		}
		.calSelect:hover{
			background-color: #abc5ee;
		}
		.calWeekRow{

		}
		.calWeek{
			min-height: 10%;
			object-fit: cover;
		}
		.calWeek:hover{
		}
		.calDay{
		}
		.calDay:before{
		}
		.calHour{
			min-height: 2%;
			object-fit: cover;
		}
		.calDayW{
		}
		.calDayD{
		}

	</style>

<script type="text/javascript">
	//Adds numbers based on the dimensions passed
	var _cont_id = "cal_grid_cont";
	var _switchType = "";
	var _select_class = "calSelect";
	var _select_id = "";
	var headerArray_top = [];
	var headerArray_side = [];
	var gridArray = [];
	var calArray = [];
	var x_offset = 0, y_offset = 0;
	var _days_of_week = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
	var _days_of_week_abv = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];
	var _days_of_week_abv_abv = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];

	window.addEventListener("resize", windowResized);
	function windowResized(){
		console.log("window resized");
		var breakpoint = getResponsiveBreakpoint();
		console.log("breakpoint:" + breakpoint);
		switch(breakpoint){
			case "xs":
				elongateHeader();
				abbreviateHeader_xs();
				break;
			case "sm":
				elongateHeader();
				abbreviateHeader();
				break;
			default:
				elongateHeader();
		}
		ensureBoxSize();
	}
	function ensureBoxSize(){
		console.log(calArray);
		switch(_switchType){
			case "month":
				// change height of each row to be the width of one column

				break;
			default:
		}
	}
	function abbreviateHeader_xs(){
		for (var i = 0; i < headerArray_top.length; i++) {
			var curr_head = headerArray_top[i];
			if(curr_head.innerHTML.includes(_days_of_week[i])){
				var new_inner = curr_head.innerHTML.replace(_days_of_week[i], _days_of_week_abv_abv[i]);
				curr_head.innerHTML = new_inner;
			}
			// console.log(curr_head);
		}
	}
	function abbreviateHeader(){
		for (var i = 0; i < headerArray_top.length; i++) {
			var curr_head = headerArray_top[i];
			if(curr_head.innerHTML.includes(_days_of_week[i])){
				var new_inner = curr_head.innerHTML.replace(_days_of_week[i], _days_of_week_abv[i]);
				curr_head.innerHTML = new_inner;
			}
			// console.log(curr_head);
		}
	}
	function elongateHeader(){
		for (var i = 0; i < headerArray_top.length; i++) {
			var curr_head = headerArray_top[i];
			if(curr_head.innerHTML.includes(_days_of_week[i]) == false){
				if(curr_head.innerHTML.includes(_days_of_week_abv[i])){
					var new_inner = curr_head.innerHTML.replace(_days_of_week_abv[i], _days_of_week[i]);
					curr_head.innerHTML = new_inner;
				}else if(curr_head.innerHTML.includes(_days_of_week_abv_abv[i])){
					var new_inner = curr_head.innerHTML.replace(_days_of_week_abv_abv[i], _days_of_week[i]);
					curr_head.innerHTML = new_inner;
				}
			}
			// console.log(curr_head);
		}
	}

	// Gets what size the screen is at.
	function getResponsiveBreakpoint() {
	    var envs = ["xs", "sm", "md", "lg"];
	    var env = "";

	    var $el = $("<div>");
	    $el.appendTo($("body"));

	    for (var i = envs.length - 1; i >= 0; i--) {
	        env = envs[i];
	        $el.addClass("d-" + env + "-none");;
	        if ($el.is(":hidden")) {
	            break; // env detected
	        }
	    }
	    $el.remove();
	    return env;
	}


	function makeGrid(cont_id, rowClass, colClass, name, dim_x, dim_y, onclick_func, generateTopHeader_func, generateSideHeader_func){
		var cont_div = document.getElementById(cont_id);
		var children = cont_div.childNodes;
		x_offset = (generateSideHeader_func(0) == null ? 0 : 1);
		y_offset = (generateTopHeader_func(0) == null ? 0 : 1);
		while (cont_div.hasChildNodes()) {
		    cont_div.removeChild(cont_div.lastChild);
		}
		gridArray = [];
		calArray = [];
		headerArray_top = [];
		headerArray_side = [];
		var top_row = document.createElement('div');
		top_row.className = "row";
		var row_array = [];
		if(generateSideHeader_func(0) != null){
			var padding = document.createElement('div');
			padding.className = "col-1";
			top_row.appendChild(padding);
			row_array.push(padding);
		}
		for (var i = 0; i < dim_x; i++) {
			var curr_col = generateTopHeader_func(i);
			top_row.appendChild(curr_col);
			headerArray_top.push(curr_col);
			row_array.push(curr_col);
		}
		cont_div.appendChild(top_row);
		gridArray.push(row_array);
		for(var i=0; i< dim_y; i++){
			var curr_row = document.createElement('div');
			curr_row.className = "row " + rowClass;
			curr_row.id = rowClass + "_r" + i;
			row_array = [];
			var cal_row = [];
			var side_header = generateSideHeader_func(i);
			if(side_header != null){
				curr_row.appendChild(side_header);
				headerArray_side.push(side_header);
				row_array.push(side_header);
			}
			for(var j=0; j < dim_x; j++){
				var curr_col = document.createElement('div');
				curr_col.className = "col " + colClass;
				curr_col.id = name + "_r:" + i + ",c:"+  j;
				curr_col.onclick = function(){
					onclick_func(this.id);
				};
				curr_row.appendChild(curr_col);
				row_array.push(curr_col);
				cal_row.push(curr_col);
			}
			cont_div.appendChild(curr_row);
			gridArray.push(row_array);
			calArray.push(cal_row);
		}
		// console.log(gridArray);
		console.log(headerArray_top);
		windowResized();
	}
	function switchCalendarView(cont_id, switchType){
		var cont_div = document.getElementById(cont_id);
		cont_div.innerHTML = "";
		_switchType = switchType;
		switch(switchType){
			case "day":
				makeGrid(cont_id, "calDayD", "defStyle calHour", "D", 1, 24, hourClickD, dayTopHeader, hourLeftHeader);
				break;
			case "week":
				makeGrid(cont_id, "calDayW", "defStyle calHour", "W", 7, 24, hourClickW, weekDatesHeader, hourLeftHeader);
				break;
			case "month":
			default:
				makeGrid(cont_id, "calWeek", "defStyle calDay", "M", 7, 6, dayClickM, weekDaysHeader, noLeftHeader);
				fillMonthViewNumbers();
		}
	}
	function dayTopHeader(col_index){
		var ret_div = document.createElement('div');
		ret_div.className = "col text-center defTopHeaderClass";
		ret_div.id = ret_div.className + ":" + col_index;
		ret_div.innerHTML = "Tempday ##/##/####";
		return ret_div;
	}
	function weekDatesHeader(col_index){
		var ret_div = document.createElement('div');
		ret_div.className = "col text-center defTopHeaderClass";
		ret_div.id = ret_div.className + ":" + col_index;
		ret_div.innerHTML = _days_of_week[col_index] + "<br/>##";
		return ret_div;
	}
	function weekDaysHeader(col_index){
		var ret_div = document.createElement('div');
		ret_div.className = "col text-center defTopHeaderClass";
		ret_div.id = ret_div.className + ":" + col_index;
		ret_div.innerHTML = _days_of_week[col_index];
		return ret_div;
	}
	function noLeftHeader(row_index){
		return null;
	}
	function hourLeftHeader(row_index){
		var ret_div = document.createElement('div');
		ret_div.className = "col-1 defLeftHeaderClass";
		ret_div.id = ret_div.className + ":" + row_index;
		var str_to = row_index + "";
		if(str_to.length != 2){
			str_to = "0" + str_to;
		}
		ret_div.innerHTML = str_to;
			return ret_div;
	}

	function coordinates_to_div(row_index, col_index){
		if(row_index + y_offset < 0 || row_index + y_offset > gridArray.length){
			return null;
		}
		if(col_index + x_offset < 0 || col_index + x_offset > gridArray[0].length){
			return null;
		}
		var curr_div = gridArray[row_index + y_offset][col_index + x_offset];
		return curr_div;
	}

	function fillMonthViewNumbers(){

	}

	function textInputCalbox(row_index, col_index, textInput){
		var curr_div = coordinates_to_div(row_index, col_index);
		curr_div.innerHTML = textInput;
		console.log(curr_div);
	}

	function select_id_to_coordinates(select_id){
		var retArr = null;
		for (var i = 0; i < gridArray.length; i++) {
			for (var j = 0; j < gridArray[i].length; j++) {
				var curr_div = gridArray[i][j];
				if(curr_div.id === select_id){
					retArr = [i - y_offset, j - x_offset];
					return retArr;
				}
			}
		}
		return retArr;
	}
	function selectUnique(cont_id, select_id){
		switchCalendarView(_cont_id, _switchType);
		select(select_id);
		var coords = select_id_to_coordinates(select_id);
		textInputCalbox(coords[0], coords[1], "1");
	}

	function select(select_id){
		var toSelect = document.getElementById(select_id);
		if(toSelect == null){
			return;
		}
		_select_id = select_id;
		console.log("select_new:" + select_id);
		toSelect.className += " " + _select_class;
		toSelect.setAttribute("selected", "true");
	}

	function dayClickM(click_id){
		console.log("dayClick:" + click_id);
		// console.log("week selected");
		selectUnique(_cont_id, click_id)
		// switchCalendarView(_cont_id, "week");
	}
	function hourClickW(click_id){
		console.log("hourClickW:" + click_id);
		selectUnique(_cont_id, click_id)
		// switchCalendarView(_cont_id, "day");
	}

	function hourClickD(click_id){
		console.log("hourClickD:" + click_id);
		selectUnique(_cont_id, click_id)
		// switchCalendarView(_cont_id, "month");
	}

	switchCalendarView(_cont_id, "month");
	textInputCalbox(0, 0, "1");

</script>

{% endblock %}
